openapi: 3.0.0
info:
  title: Steak Kenangan Restaurant POS API
  version: 1.0.0
  description: |
    Restaurant Point of Sale system API with public website integration.
    Supports Indonesian localization (IDR currency, Bahasa Indonesia).
  contact:
    name: API Support
    email: support@steakkenangan.com

servers:
  - url: http://localhost:8080/api
    description: Development server
  - url: https://api.steakkenangan.com/api
    description: Production server

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT token obtained from /auth/login endpoint

  schemas:
    Error:
      type: object
      required: [error]
      properties:
        error:
          type: string
          example: "Validation failed"
        message:
          type: string
          example: "Email is required"
        details:
          type: object
          additionalProperties: true

    MenuItem:
      type: object
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
          example: "Rendang Wagyu Steak"
        description:
          type: string
          nullable: true
          example: "Wagyu steak dengan bumbu rendang khas Padang"
        price:
          type: integer
          description: Price in smallest currency unit (IDR, no decimals)
          example: 285000
        image_url:
          type: string
          nullable: true
          example: "https://cdn.example.com/rendang-wagyu.jpg"
        category_id:
          type: string
          format: uuid
        category_name:
          type: string
          example: "Steak Nusantara"
        is_available:
          type: boolean
          example: true

    Category:
      type: object
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
          example: "Steak Nusantara"
        description:
          type: string
          nullable: true
        color:
          type: string
          nullable: true
          example: "#d4a574"
        sort_order:
          type: integer
          example: 1

    RestaurantInfo:
      type: object
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
          example: "Steak Kenangan"
        tagline:
          type: string
          nullable: true
          example: "Premium Indonesian Steakhouse"
        description:
          type: string
          nullable: true
        address:
          type: string
          example: "Jl. Sudirman No. 123"
        city:
          type: string
          example: "Jakarta"
        phone:
          type: string
          example: "+62 21 1234567"
        email:
          type: string
          example: "contact@steakkenangan.com"
        whatsapp:
          type: string
          nullable: true
        map_latitude:
          type: number
          format: double
          nullable: true
        map_longitude:
          type: number
          format: double
          nullable: true
        instagram_url:
          type: string
          nullable: true
        facebook_url:
          type: string
          nullable: true
        is_open_now:
          type: boolean
          description: Calculated field based on current time and operating hours
        operating_hours:
          type: array
          items:
            $ref: '#/components/schemas/OperatingHours'

    OperatingHours:
      type: object
      properties:
        id:
          type: string
          format: uuid
        day_of_week:
          type: integer
          minimum: 0
          maximum: 6
          description: 0=Sunday, 1=Monday, ..., 6=Saturday
        open_time:
          type: string
          format: time
          example: "10:00:00"
        close_time:
          type: string
          format: time
          example: "22:00:00"
        is_closed:
          type: boolean

    ContactSubmission:
      type: object
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
          example: "John Doe"
        email:
          type: string
          format: email
          example: "john@example.com"
        phone:
          type: string
          nullable: true
        subject:
          type: string
          example: "Reservation"
        message:
          type: string
          example: "I would like to make a reservation for 4 people"
        status:
          type: string
          enum: [new, in_progress, resolved, spam]
          default: new
        created_at:
          type: string
          format: date-time

    Order:
      type: object
      properties:
        id:
          type: string
          format: uuid
        order_number:
          type: string
          example: "ORD-20241223-001"
        table_id:
          type: string
          format: uuid
          nullable: true
        table_number:
          type: string
          nullable: true
        customer_name:
          type: string
          nullable: true
        order_type:
          type: string
          enum: [dine-in, takeaway, delivery]
        status:
          type: string
          enum: [pending, preparing, ready, completed, cancelled]
        subtotal:
          type: integer
          description: Amount in IDR (smallest unit)
        tax_amount:
          type: integer
        service_charge:
          type: integer
        total_amount:
          type: integer
        payment_method:
          type: string
          nullable: true
          enum: [cash, card, qris, gopay, ovo]
        payment_status:
          type: string
          enum: [unpaid, paid, refunded]
        items:
          type: array
          items:
            $ref: '#/components/schemas/OrderItem'
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    OrderItem:
      type: object
      properties:
        id:
          type: string
          format: uuid
        product_id:
          type: string
          format: uuid
        product_name:
          type: string
        quantity:
          type: integer
          minimum: 1
        unit_price:
          type: integer
        subtotal:
          type: integer
        notes:
          type: string
          nullable: true

    InventoryItem:
      type: object
      properties:
        id:
          type: string
          format: uuid
        product_id:
          type: string
          format: uuid
        product_name:
          type: string
        category_name:
          type: string
        current_stock:
          type: integer
        minimum_stock:
          type: integer
        maximum_stock:
          type: integer
        unit:
          type: string
          example: "kg"
        status:
          type: string
          enum: [ok, low, out]
          description: ok=above minimum, low=below minimum, out=zero stock

    SystemSettings:
      type: object
      properties:
        tax_rate:
          type: number
          example: 11.0
          description: Tax rate percentage (11% VAT for Indonesia)
        service_charge:
          type: number
          example: 5.0
        currency:
          type: string
          example: "IDR"
        restaurant_name:
          type: string
        receipt_header:
          type: string
        receipt_footer:
          type: string

    Notification:
      type: object
      properties:
        id:
          type: string
          format: uuid
        type:
          type: string
          enum: [order, inventory, payment, system]
        title:
          type: string
        message:
          type: string
        is_read:
          type: boolean
        created_at:
          type: string
          format: date-time

    User:
      type: object
      properties:
        id:
          type: string
          format: uuid
        username:
          type: string
        first_name:
          type: string
        last_name:
          type: string
        email:
          type: string
          format: email
        role:
          type: string
          enum: [admin, manager, server, counter, kitchen]
        is_active:
          type: boolean

paths:
  # ===== Authentication =====
  /auth/login:
    post:
      tags: [Authentication]
      summary: User login
      description: Authenticate user and receive JWT token
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [username, password]
              properties:
                username:
                  type: string
                  example: "admin"
                password:
                  type: string
                  format: password
                  example: "admin123"
      responses:
        '200':
          description: Login successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  token:
                    type: string
                    example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
                  user:
                    $ref: '#/components/schemas/User'
        '401':
          description: Invalid credentials
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /auth/me:
    get:
      tags: [Authentication]
      summary: Get current user
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Current user info
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '401':
          description: Unauthorized

  # ===== Public Endpoints (No Auth) =====
  /v1/public/menu:
    get:
      tags: [Public]
      summary: Get public menu
      description: Returns all active products with category information
      parameters:
        - name: category
          in: query
          schema:
            type: string
            format: uuid
          description: Filter by category ID
        - name: search
          in: query
          schema:
            type: string
          description: Search in product name and description
      responses:
        '200':
          description: Menu items
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/MenuItem'

  /v1/public/categories:
    get:
      tags: [Public]
      summary: Get all categories
      responses:
        '200':
          description: Product categories
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Category'

  /v1/public/restaurant:
    get:
      tags: [Public]
      summary: Get restaurant information
      description: Returns restaurant details including operating hours and current open/closed status
      responses:
        '200':
          description: Restaurant information
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RestaurantInfo'

  /v1/public/contact:
    post:
      tags: [Public]
      summary: Submit contact form
      description: Submit customer inquiry or feedback
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [name, email, subject, message]
              properties:
                name:
                  type: string
                  minLength: 2
                  example: "John Doe"
                email:
                  type: string
                  format: email
                  example: "john@example.com"
                phone:
                  type: string
                  nullable: true
                subject:
                  type: string
                  enum: [Reservation, Feedback, Catering, General Inquiry]
                message:
                  type: string
                  minLength: 10
      responses:
        '201':
          description: Contact submission created
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: string
                    format: uuid
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  # ===== Orders =====
  /v1/orders:
    post:
      tags: [Orders]
      summary: Create new order
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [order_type, items]
              properties:
                table_id:
                  type: string
                  format: uuid
                  nullable: true
                order_type:
                  type: string
                  enum: [dine-in, takeaway, delivery]
                customer_name:
                  type: string
                  nullable: true
                notes:
                  type: string
                  nullable: true
                items:
                  type: array
                  minItems: 1
                  items:
                    type: object
                    required: [product_id, quantity]
                    properties:
                      product_id:
                        type: string
                        format: uuid
                      quantity:
                        type: integer
                        minimum: 1
                      notes:
                        type: string
                        nullable: true
      responses:
        '201':
          description: Order created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Order'
        '400':
          description: Validation error
        '401':
          description: Unauthorized

    get:
      tags: [Orders]
      summary: List orders
      security:
        - BearerAuth: []
      parameters:
        - name: status
          in: query
          schema:
            type: string
            enum: [pending, preparing, ready, completed, cancelled]
        - name: type
          in: query
          schema:
            type: string
            enum: [dine-in, takeaway, delivery]
        - name: table_id
          in: query
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: List of orders
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Order'

  /v1/orders/{id}:
    get:
      tags: [Orders]
      summary: Get order details
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Order details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Order'
        '404':
          description: Order not found

  /v1/orders/{id}/status:
    put:
      tags: [Orders]
      summary: Update order status
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [status]
              properties:
                status:
                  type: string
                  enum: [pending, preparing, ready, completed, cancelled]
                notes:
                  type: string
                  nullable: true
      responses:
        '200':
          description: Status updated
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
        '404':
          description: Order not found

  /v1/orders/{id}/payment:
    put:
      tags: [Orders]
      summary: Process payment
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [payment_method, amount_paid]
              properties:
                payment_method:
                  type: string
                  enum: [cash, card, qris, gopay, ovo]
                amount_paid:
                  type: integer
                  minimum: 0
      responses:
        '200':
          description: Payment processed
        '400':
          description: Payment amount mismatch

  # ===== Inventory =====
  /v1/inventory:
    get:
      tags: [Inventory]
      summary: Get all inventory items
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Inventory items
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/InventoryItem'

  /v1/inventory/adjust:
    post:
      tags: [Inventory]
      summary: Adjust inventory stock
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [product_id, operation, quantity, reason]
              properties:
                product_id:
                  type: string
                  format: uuid
                operation:
                  type: string
                  enum: [add, remove]
                quantity:
                  type: integer
                  minimum: 1
                reason:
                  type: string
                  enum: [Purchase, Sale, Spoilage, Manual Adjustment, Inventory Count]
                notes:
                  type: string
                  nullable: true
      responses:
        '201':
          description: Stock adjusted
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: string
                    format: uuid
                  new_stock:
                    type: integer

  /v1/inventory/history/{product_id}:
    get:
      tags: [Inventory]
      summary: Get inventory history for product
      security:
        - BearerAuth: []
      parameters:
        - name: product_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Inventory history
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    id:
                      type: string
                      format: uuid
                    operation:
                      type: string
                    quantity:
                      type: integer
                    previous_stock:
                      type: integer
                    new_stock:
                      type: integer
                    reason:
                      type: string
                    notes:
                      type: string
                      nullable: true
                    adjusted_by_name:
                      type: string
                    created_at:
                      type: string
                      format: date-time

  # ===== Settings =====
  /v1/settings:
    get:
      tags: [Settings]
      summary: Get all system settings
      security:
        - BearerAuth: []
      responses:
        '200':
          description: System settings
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SystemSettings'

    put:
      tags: [Settings]
      summary: Update system settings
      security:
        - BearerAuth: []
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SystemSettings'
      responses:
        '200':
          description: Settings updated
        '403':
          description: Forbidden (admin only)

  /v1/health:
    get:
      tags: [System]
      summary: System health check
      security:
        - BearerAuth: []
      responses:
        '200':
          description: System health status
          content:
            application/json:
              schema:
                type: object
                properties:
                  database:
                    type: object
                    properties:
                      status:
                        type: string
                        enum: [connected, error]
                      latency_ms:
                        type: integer
                      last_check:
                        type: string
                        format: date-time
                  api:
                    type: object
                    properties:
                      status:
                        type: string
                      version:
                        type: string
                  backup:
                    type: object
                    properties:
                      status:
                        type: string
                      last_backup:
                        type: string
                        format: date-time
                      next_backup:
                        type: string
                        format: date-time

  # ===== Contact Submissions (Admin) =====
  /v1/admin/contacts:
    get:
      tags: [Admin - Contacts]
      summary: Get contact submissions
      security:
        - BearerAuth: []
      parameters:
        - name: status
          in: query
          schema:
            type: string
            enum: [new, in_progress, resolved, spam]
        - name: page
          in: query
          schema:
            type: integer
            minimum: 1
            default: 1
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 50
      responses:
        '200':
          description: Contact submissions
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/ContactSubmission'
                  total:
                    type: integer
                  page:
                    type: integer
                  limit:
                    type: integer

  /v1/admin/contacts/{id}/status:
    put:
      tags: [Admin - Contacts]
      summary: Update contact submission status
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [status]
              properties:
                status:
                  type: string
                  enum: [new, in_progress, resolved, spam]
      responses:
        '200':
          description: Status updated
        '404':
          description: Contact submission not found

  /v1/admin/contacts/{id}:
    delete:
      tags: [Admin - Contacts]
      summary: Delete contact submission
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Deleted successfully
        '404':
          description: Not found

  # ===== Notifications =====
  /v1/notifications:
    get:
      tags: [Notifications]
      summary: Get user notifications
      security:
        - BearerAuth: []
      parameters:
        - name: type
          in: query
          schema:
            type: string
            enum: [order, inventory, payment, system]
        - name: is_read
          in: query
          schema:
            type: boolean
      responses:
        '200':
          description: Notifications
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Notification'

  /v1/notifications/{id}/read:
    put:
      tags: [Notifications]
      summary: Mark notification as read
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Marked as read

  /v1/notifications/{id}:
    delete:
      tags: [Notifications]
      summary: Delete notification
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Deleted

tags:
  - name: Authentication
    description: User authentication and authorization
  - name: Public
    description: Public API endpoints (no authentication required)
  - name: Orders
    description: Order management
  - name: Inventory
    description: Inventory tracking and management
  - name: Settings
    description: System configuration
  - name: System
    description: System health and monitoring
  - name: Admin - Contacts
    description: Admin-only contact submission management
  - name: Notifications
    description: User notifications
