<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Test Receipt Generator</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 1200px;
      margin: 20px auto;
      padding: 20px;
      background: #f5f5f5;
    }
    .container {
      background: white;
      padding: 30px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    h1 {
      color: #333;
      margin-bottom: 20px;
    }
    .controls {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 15px;
      margin-bottom: 30px;
    }
    .form-group {
      display: flex;
      flex-direction: column;
    }
    label {
      font-weight: bold;
      margin-bottom: 5px;
      color: #555;
    }
    input, select, button {
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 14px;
    }
    button {
      background: #4CAF50;
      color: white;
      border: none;
      cursor: pointer;
      font-weight: bold;
      margin: 5px;
    }
    button:hover {
      background: #45a049;
    }
    button.secondary {
      background: #2196F3;
    }
    button.secondary:hover {
      background: #0b7dda;
    }
    button.tertiary {
      background: #FF9800;
    }
    button.tertiary:hover {
      background: #e68900;
    }
    .button-group {
      display: flex;
      gap: 10px;
      margin-top: 20px;
    }
    .preview-container {
      margin-top: 30px;
      border: 2px solid #ddd;
      border-radius: 8px;
      padding: 20px;
      background: #fafafa;
    }
    .preview-title {
      font-size: 18px;
      font-weight: bold;
      margin-bottom: 15px;
      color: #333;
    }
    #preview {
      background: white;
      padding: 20px;
      border-radius: 4px;
      min-height: 200px;
    }
    .info {
      background: #e3f2fd;
      padding: 15px;
      border-radius: 4px;
      margin-bottom: 20px;
      border-left: 4px solid #2196F3;
    }
    .sample-data {
      background: #fff3e0;
      padding: 15px;
      border-radius: 4px;
      margin-top: 20px;
      border-left: 4px solid #FF9800;
    }
    .sample-data h3 {
      margin-top: 0;
      color: #e65100;
    }
    .sample-data pre {
      background: white;
      padding: 10px;
      border-radius: 4px;
      overflow-x: auto;
      font-size: 12px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üßæ Test Receipt Generator - Steak Kenangan</h1>
    
    <div class="info">
      <strong>üìã Testing Instructions:</strong>
      <p>This tool generates sample receipts to test the printing functionality. You can customize the receipt data and preview before downloading.</p>
    </div>

    <div class="controls">
      <div class="form-group">
        <label>Paper Size:</label>
        <select id="paperSize">
          <option value="80mm">80mm (Standard)</option>
          <option value="58mm">58mm (Small)</option>
        </select>
      </div>
      
      <div class="form-group">
        <label>Order Number:</label>
        <input type="text" id="orderNumber" value="ORD-2024-12-001" />
      </div>
      
      <div class="form-group">
        <label>Order Type:</label>
        <select id="orderType">
          <option value="dine_in">Makan di Tempat</option>
          <option value="takeaway">Bawa Pulang</option>
          <option value="delivery">Antar</option>
        </select>
      </div>
      
      <div class="form-group">
        <label>Table Number:</label>
        <input type="text" id="tableNumber" value="12" />
      </div>
      
      <div class="form-group">
        <label>Customer Name:</label>
        <input type="text" id="customerName" value="Budi Santoso" />
      </div>
      
      <div class="form-group">
        <label>Payment Method:</label>
        <select id="paymentMethod">
          <option value="cash">Tunai</option>
          <option value="card">Kartu</option>
          <option value="digital_wallet">Dompet Digital</option>
          <option value="qris">QRIS</option>
        </select>
      </div>
    </div>

    <div class="button-group">
      <button onclick="generateReceipt()">üìÑ Generate Receipt</button>
      <button class="secondary" onclick="downloadReceipt()">üíæ Download HTML</button>
      <button class="tertiary" onclick="printReceipt()">üñ®Ô∏è Print Receipt</button>
    </div>

    <div class="sample-data">
      <h3>Sample Order Data:</h3>
      <pre id="sampleData"></pre>
    </div>

    <div class="preview-container">
      <div class="preview-title">Receipt Preview:</div>
      <div id="preview"></div>
    </div>
  </div>

  <script>
    // Sample receipt data
    const sampleOrderData = {
      order_number: 'ORD-2024-12-001',
      order_date: new Date().toISOString(),
      order_type: 'dine_in',
      table_number: '12',
      customer_name: 'Budi Santoso',
      cashier_name: 'Admin User',
      items: [
        {
          product_name: 'Wagyu Steak A5 (250g)',
          quantity: 1,
          unit_price: 450000,
          total_price: 450000,
          special_instructions: 'Medium rare, extra sauce'
        },
        {
          product_name: 'Grilled Salmon',
          quantity: 2,
          unit_price: 185000,
          total_price: 370000
        },
        {
          product_name: 'Caesar Salad',
          quantity: 1,
          unit_price: 65000,
          total_price: 65000
        },
        {
          product_name: 'French Fries',
          quantity: 2,
          unit_price: 35000,
          total_price: 70000
        },
        {
          product_name: 'Iced Lemon Tea',
          quantity: 2,
          unit_price: 25000,
          total_price: 50000
        },
        {
          product_name: 'Mineral Water',
          quantity: 1,
          unit_price: 15000,
          total_price: 15000
        }
      ],
      subtotal: 1020000,
      tax_amount: 112200, // 11%
      service_charge: 51000, // 5%
      discount_amount: 0,
      total_amount: 1183200,
      payment_method: 'cash',
      payment_amount: 1200000,
      change_amount: 16800
    };

    // Display sample data
    document.getElementById('sampleData').textContent = JSON.stringify(sampleOrderData, null, 2);

    function formatCurrency(amount) {
      return new Intl.NumberFormat('id-ID', {
        style: 'currency',
        currency: 'IDR',
        minimumFractionDigits: 0,
        maximumFractionDigits: 0,
      }).format(amount);
    }

    function formatDate(dateString) {
      const date = new Date(dateString);
      return date.toLocaleDateString('id-ID', {
        day: '2-digit',
        month: 'short',
        year: 'numeric',
        hour: '2-digit',
        minute: '2-digit'
      });
    }

    function formatOrderType(type) {
      const types = {
        dine_in: 'Makan di Tempat',
        takeaway: 'Bawa Pulang',
        delivery: 'Antar'
      };
      return types[type] || type;
    }

    function formatPaymentMethod(method) {
      const methods = {
        cash: 'Tunai',
        card: 'Kartu',
        digital_wallet: 'Dompet Digital',
        qris: 'QRIS'
      };
      return methods[method] || method;
    }

    function getReceiptData() {
      const data = { ...sampleOrderData };
      data.order_number = document.getElementById('orderNumber').value;
      data.order_type = document.getElementById('orderType').value;
      data.table_number = document.getElementById('tableNumber').value;
      data.customer_name = document.getElementById('customerName').value;
      data.payment_method = document.getElementById('paymentMethod').value;
      return data;
    }

    function generateReceiptHTML(data, paperSize) {
      const width = paperSize === '58mm' ? '58mm' : '80mm';
      const fontSize = paperSize === '58mm' ? '10px' : '12px';

      return `
<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <style>
    @page {
      size: ${width} auto;
      margin: 0;
    }
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      width: ${width};
      font-family: 'Courier New', monospace;
      font-size: ${fontSize};
      padding: 8px;
      background: white;
    }
    .header {
      text-align: center;
      margin-bottom: 10px;
      border-bottom: 1px dashed #000;
      padding-bottom: 8px;
    }
    .header h1 {
      font-size: ${paperSize === '58mm' ? '14px' : '16px'};
      font-weight: bold;
      margin-bottom: 4px;
    }
    .header p {
      font-size: ${paperSize === '58mm' ? '9px' : '10px'};
      margin: 2px 0;
    }
    .section {
      margin: 10px 0;
      border-bottom: 1px dashed #000;
      padding-bottom: 8px;
    }
    .info-row {
      display: flex;
      justify-content: space-between;
      margin: 3px 0;
      font-size: ${fontSize};
    }
    .items {
      margin: 10px 0;
    }
    .item {
      margin: 5px 0;
    }
    .item-name {
      font-weight: bold;
    }
    .item-details {
      display: flex;
      justify-content: space-between;
      font-size: ${paperSize === '58mm' ? '9px' : '11px'};
      margin: 2px 0;
    }
    .item-instructions {
      font-size: ${paperSize === '58mm' ? '8px' : '10px'};
      font-style: italic;
      color: #666;
      margin: 2px 0 2px 10px;
    }
    .totals {
      margin: 10px 0;
    }
    .total-row {
      display: flex;
      justify-content: space-between;
      margin: 4px 0;
    }
    .total-row.grand {
      font-weight: bold;
      font-size: ${paperSize === '58mm' ? '12px' : '14px'};
      border-top: 2px solid #000;
      padding-top: 6px;
      margin-top: 6px;
    }
    .payment {
      margin: 10px 0;
      border-top: 1px dashed #000;
      padding-top: 8px;
    }
    .footer {
      text-align: center;
      margin-top: 10px;
      font-size: ${paperSize === '58mm' ? '9px' : '10px'};
      border-top: 1px dashed #000;
      padding-top: 8px;
    }
    .barcode {
      text-align: center;
      margin: 10px 0;
      font-family: monospace;
      font-size: 24px;
      letter-spacing: 2px;
    }
    @media print {
      body {
        -webkit-print-color-adjust: exact;
        print-color-adjust: exact;
      }
    }
  </style>
</head>
<body>
  <!-- Header -->
  <div class="header">
    <h1>STEAK KENANGAN</h1>
    <p>Jl. Sudirman No. 123, Jakarta</p>
    <p>Telp: (021) 1234-5678</p>
    <p>================================</p>
  </div>

  <!-- Order Info -->
  <div class="section">
    <div class="info-row">
      <span>No. Pesanan:</span>
      <span><strong>#${data.order_number}</strong></span>
    </div>
    <div class="info-row">
      <span>Tanggal:</span>
      <span>${formatDate(data.order_date)}</span>
    </div>
    <div class="info-row">
      <span>Jenis:</span>
      <span>${formatOrderType(data.order_type)}</span>
    </div>
    ${data.table_number ? `
    <div class="info-row">
      <span>Meja:</span>
      <span>${data.table_number}</span>
    </div>
    ` : ''}
    ${data.customer_name ? `
    <div class="info-row">
      <span>Nama:</span>
      <span>${data.customer_name}</span>
    </div>
    ` : ''}
    ${data.cashier_name ? `
    <div class="info-row">
      <span>Kasir:</span>
      <span>${data.cashier_name}</span>
    </div>
    ` : ''}
  </div>

  <!-- Items -->
  <div class="items">
    ${data.items.map(item => `
      <div class="item">
        <div class="item-name">${item.product_name}</div>
        <div class="item-details">
          <span>${item.quantity} x ${formatCurrency(item.unit_price)}</span>
          <span>${formatCurrency(item.total_price)}</span>
        </div>
        ${item.special_instructions ? `
        <div class="item-instructions">* ${item.special_instructions}</div>
        ` : ''}
      </div>
    `).join('')}
  </div>

  <!-- Totals -->
  <div class="totals">
    <div class="total-row">
      <span>Subtotal:</span>
      <span>${formatCurrency(data.subtotal)}</span>
    </div>
    ${data.service_charge && data.service_charge > 0 ? `
    <div class="total-row">
      <span>Biaya Layanan (5%):</span>
      <span>${formatCurrency(data.service_charge)}</span>
    </div>
    ` : ''}
    <div class="total-row">
      <span>Pajak (11%):</span>
      <span>${formatCurrency(data.tax_amount)}</span>
    </div>
    ${data.discount_amount && data.discount_amount > 0 ? `
    <div class="total-row">
      <span>Diskon:</span>
      <span>-${formatCurrency(data.discount_amount)}</span>
    </div>
    ` : ''}
    <div class="total-row grand">
      <span>TOTAL:</span>
      <span>${formatCurrency(data.total_amount)}</span>
    </div>
  </div>

  <!-- Payment -->
  ${data.payment_method ? `
  <div class="payment">
    <div class="total-row">
      <span>Metode Bayar:</span>
      <span>${formatPaymentMethod(data.payment_method)}</span>
    </div>
    ${data.payment_amount ? `
    <div class="total-row">
      <span>Dibayar:</span>
      <span>${formatCurrency(data.payment_amount)}</span>
    </div>
    ` : ''}
    ${data.change_amount && data.change_amount > 0 ? `
    <div class="total-row">
      <span>Kembalian:</span>
      <span>${formatCurrency(data.change_amount)}</span>
    </div>
    ` : ''}
  </div>
  ` : ''}

  <!-- Barcode -->
  <div class="barcode">*${data.order_number}*</div>

  <!-- Footer -->
  <div class="footer">
    <p>Terima kasih atas kunjungan Anda!</p>
    <p style="margin-top: 4px;">Selamat menikmati!</p>
    <p style="margin-top: 8px;">================================</p>
    <p style="margin-top: 4px; font-size: ${paperSize === '58mm' ? '8px' : '9px'};">
      Powered by Modern POS System
    </p>
  </div>
</body>
</html>
      `.trim();
    }

    function generateReceipt() {
      const paperSize = document.getElementById('paperSize').value;
      const data = getReceiptData();
      const html = generateReceiptHTML(data, paperSize);
      
      document.getElementById('preview').innerHTML = html;
      alert('‚úÖ Receipt generated successfully! Scroll down to see preview.');
    }

    function downloadReceipt() {
      const paperSize = document.getElementById('paperSize').value;
      const data = getReceiptData();
      const html = generateReceiptHTML(data, paperSize);
      
      const blob = new Blob([html], { type: 'text/html' });
      const url = URL.createObjectURL(blob);
      const link = document.createElement('a');
      link.href = url;
      link.download = `receipt_${data.order_number}_${Date.now()}.html`;
      link.click();
      URL.revokeObjectURL(url);
      
      alert('‚úÖ Receipt downloaded as HTML! Open it in a browser and use Print to PDF.');
    }

    function printReceipt() {
      const paperSize = document.getElementById('paperSize').value;
      const data = getReceiptData();
      const html = generateReceiptHTML(data, paperSize);
      
      const iframe = document.createElement('iframe');
      iframe.style.display = 'none';
      document.body.appendChild(iframe);

      const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
      iframeDoc.open();
      iframeDoc.write(html);
      iframeDoc.close();

      setTimeout(() => {
        iframe.contentWindow.focus();
        iframe.contentWindow.print();
        
        setTimeout(() => {
          document.body.removeChild(iframe);
        }, 1000);
      }, 500);
    }

    // Generate on load
    window.onload = function() {
      generateReceipt();
    };
  </script>
</body>
</html>
